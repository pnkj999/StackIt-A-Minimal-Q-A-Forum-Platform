{"ast":null,"code":"// frontend/src/contexts/AuthContext.js\nimport React,{createContext,useContext,useState,useEffect}from'react';import jwtDecode from'jwt-decode';import toast from'react-hot-toast';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[token,setToken]=useState(null);useEffect(()=>{const storedToken=localStorage.getItem('token');if(storedToken){try{const decodedToken=jwtDecode(storedToken);// Check if token is expired\nif(decodedToken.exp*1000>Date.now()){setToken(storedToken);setUser({id:decodedToken.userId,username:decodedToken.username,email:decodedToken.email,role:decodedToken.role});}else{localStorage.removeItem('token');toast.error('Session expired. Please login again.');}}catch(error){console.error('Invalid token:',error);localStorage.removeItem('token');toast.error('Invalid session. Please login again.');}}setLoading(false);},[]);const login=(newToken,userData)=>{localStorage.setItem('token',newToken);setToken(newToken);setUser(userData);toast.success(`Welcome back, ${userData.username}!`);};const logout=()=>{localStorage.removeItem('token');setToken(null);setUser(null);toast.success('Logged out successfully');};const getAuthHeader=()=>{return token?{Authorization:`Bearer ${token}`}:{};};const updateUser=userData=>{setUser(prev=>({...prev,...userData}));};const value={user,token,login,logout,updateUser,getAuthHeader,isAuthenticated:!!user,loading};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:!loading&&children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","jwtDecode","toast","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","loading","setLoading","token","setToken","storedToken","localStorage","getItem","decodedToken","exp","Date","now","id","userId","username","email","role","removeItem","error","console","login","newToken","userData","setItem","success","logout","getAuthHeader","Authorization","updateUser","prev","value","isAuthenticated","Provider"],"sources":["/Users/sam/Downloads/stackit/frontend/src/contexts/AuthContext.js"],"sourcesContent":["// frontend/src/contexts/AuthContext.js\nimport React, { createContext, useContext, useState, useEffect } from 'react';\nimport jwtDecode from 'jwt-decode';\nimport toast from 'react-hot-toast';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => {\n    const context = useContext(AuthContext);\n    if (!context) {\n        throw new Error('useAuth must be used within an AuthProvider');\n    }\n    return context;\n};\n\nexport const AuthProvider = ({ children }) => {\n    const [user, setUser] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [token, setToken] = useState(null);\n\n    useEffect(() => {\n        const storedToken = localStorage.getItem('token');\n        if (storedToken) {\n            try {\n                const decodedToken = jwtDecode(storedToken);\n                \n                // Check if token is expired\n                if (decodedToken.exp * 1000 > Date.now()) {\n                    setToken(storedToken);\n                    setUser({\n                        id: decodedToken.userId,\n                        username: decodedToken.username,\n                        email: decodedToken.email,\n                        role: decodedToken.role\n                    });\n                } else {\n                    localStorage.removeItem('token');\n                    toast.error('Session expired. Please login again.');\n                }\n            } catch (error) {\n                console.error('Invalid token:', error);\n                localStorage.removeItem('token');\n                toast.error('Invalid session. Please login again.');\n            }\n        }\n        setLoading(false);\n    }, []);\n\n    const login = (newToken, userData) => {\n        localStorage.setItem('token', newToken);\n        setToken(newToken);\n        setUser(userData);\n        toast.success(`Welcome back, ${userData.username}!`);\n    };\n\n    const logout = () => {\n        localStorage.removeItem('token');\n        setToken(null);\n        setUser(null);\n        toast.success('Logged out successfully');\n    };\n\n    const getAuthHeader = () => {\n        return token ? { Authorization: `Bearer ${token}` } : {};\n    };\n\n    const updateUser = (userData) => {\n        setUser(prev => ({ ...prev, ...userData }));\n    };\n\n    const value = {\n        user,\n        token,\n        login,\n        logout,\n        updateUser,\n        getAuthHeader,\n        isAuthenticated: !!user,\n        loading\n    };\n\n    return (\n        <AuthContext.Provider value={value}>\n            {!loading && children}\n        </AuthContext.Provider>\n    );\n};\n"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,UAAU,CAAEC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAC7E,MAAO,CAAAC,SAAS,KAAM,YAAY,CAClC,MAAO,CAAAC,KAAK,KAAM,iBAAiB,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAEpC,KAAM,CAAAC,WAAW,cAAGR,aAAa,CAAC,CAAC,CAEnC,MAAO,MAAM,CAAAS,OAAO,CAAGA,CAAA,GAAM,CACzB,KAAM,CAAAC,OAAO,CAAGT,UAAU,CAACO,WAAW,CAAC,CACvC,GAAI,CAACE,OAAO,CAAE,CACV,KAAM,IAAI,CAAAC,KAAK,CAAC,6CAA6C,CAAC,CAClE,CACA,MAAO,CAAAD,OAAO,CAClB,CAAC,CAED,MAAO,MAAM,CAAAE,YAAY,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACrC,KAAM,CAACE,IAAI,CAAEC,OAAO,CAAC,CAAGd,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACe,OAAO,CAAEC,UAAU,CAAC,CAAGhB,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACiB,KAAK,CAAEC,QAAQ,CAAC,CAAGlB,QAAQ,CAAC,IAAI,CAAC,CAExCC,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAkB,WAAW,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CACjD,GAAIF,WAAW,CAAE,CACb,GAAI,CACA,KAAM,CAAAG,YAAY,CAAGpB,SAAS,CAACiB,WAAW,CAAC,CAE3C;AACA,GAAIG,YAAY,CAACC,GAAG,CAAG,IAAI,CAAGC,IAAI,CAACC,GAAG,CAAC,CAAC,CAAE,CACtCP,QAAQ,CAACC,WAAW,CAAC,CACrBL,OAAO,CAAC,CACJY,EAAE,CAAEJ,YAAY,CAACK,MAAM,CACvBC,QAAQ,CAAEN,YAAY,CAACM,QAAQ,CAC/BC,KAAK,CAAEP,YAAY,CAACO,KAAK,CACzBC,IAAI,CAAER,YAAY,CAACQ,IACvB,CAAC,CAAC,CACN,CAAC,IAAM,CACHV,YAAY,CAACW,UAAU,CAAC,OAAO,CAAC,CAChC5B,KAAK,CAAC6B,KAAK,CAAC,sCAAsC,CAAC,CACvD,CACJ,CAAE,MAAOA,KAAK,CAAE,CACZC,OAAO,CAACD,KAAK,CAAC,gBAAgB,CAAEA,KAAK,CAAC,CACtCZ,YAAY,CAACW,UAAU,CAAC,OAAO,CAAC,CAChC5B,KAAK,CAAC6B,KAAK,CAAC,sCAAsC,CAAC,CACvD,CACJ,CACAhB,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAkB,KAAK,CAAGA,CAACC,QAAQ,CAAEC,QAAQ,GAAK,CAClChB,YAAY,CAACiB,OAAO,CAAC,OAAO,CAAEF,QAAQ,CAAC,CACvCjB,QAAQ,CAACiB,QAAQ,CAAC,CAClBrB,OAAO,CAACsB,QAAQ,CAAC,CACjBjC,KAAK,CAACmC,OAAO,CAAC,iBAAiBF,QAAQ,CAACR,QAAQ,GAAG,CAAC,CACxD,CAAC,CAED,KAAM,CAAAW,MAAM,CAAGA,CAAA,GAAM,CACjBnB,YAAY,CAACW,UAAU,CAAC,OAAO,CAAC,CAChCb,QAAQ,CAAC,IAAI,CAAC,CACdJ,OAAO,CAAC,IAAI,CAAC,CACbX,KAAK,CAACmC,OAAO,CAAC,yBAAyB,CAAC,CAC5C,CAAC,CAED,KAAM,CAAAE,aAAa,CAAGA,CAAA,GAAM,CACxB,MAAO,CAAAvB,KAAK,CAAG,CAAEwB,aAAa,CAAE,UAAUxB,KAAK,EAAG,CAAC,CAAG,CAAC,CAAC,CAC5D,CAAC,CAED,KAAM,CAAAyB,UAAU,CAAIN,QAAQ,EAAK,CAC7BtB,OAAO,CAAC6B,IAAI,GAAK,CAAE,GAAGA,IAAI,CAAE,GAAGP,QAAS,CAAC,CAAC,CAAC,CAC/C,CAAC,CAED,KAAM,CAAAQ,KAAK,CAAG,CACV/B,IAAI,CACJI,KAAK,CACLiB,KAAK,CACLK,MAAM,CACNG,UAAU,CACVF,aAAa,CACbK,eAAe,CAAE,CAAC,CAAChC,IAAI,CACvBE,OACJ,CAAC,CAED,mBACIV,IAAA,CAACC,WAAW,CAACwC,QAAQ,EAACF,KAAK,CAAEA,KAAM,CAAAhC,QAAA,CAC9B,CAACG,OAAO,EAAIH,QAAQ,CACH,CAAC,CAE/B,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}